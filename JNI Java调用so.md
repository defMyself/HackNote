# Java调用linux so动态库

1. java代码

   ```java
   package com.ruan.jni;
   
   public class Jni {
       static {
           System.load("/opt/cpp/com_ruan_jni_Jni.so");
       }
       public native int add(int a, int b);
       
       public native String print(String msg);
   }
   ```

   

```shell
javah -classpath A -d B -jni C
javah -classpath / -d / com.ruan.jni.Jni
```

```cpp
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class com_ruan_jni_Jni */

#ifndef _Included_com_ruan_jni_Jni
#define _Included_com_ruan_jni_Jni
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_ruan_jni_Jni
 * Method:    add
 * Signature: (II)I
 */
JNIEXPORT jint JNICALL Java_com_ruan_jni_Jni_add
  (JNIEnv *, jobject, jint, jint);

/*
 * Class:     com_ruan_jni_Jni
 * Method:    print
 * Signature: (Ljava/lang/String;)Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_com_ruan_jni_Jni_print
  (JNIEnv *, jobject, jstring);

#ifdef __cplusplus
}
#endif
#endif


```

```c++
#include <jni.h>
#include <iostream>
#include <com_ruan_jni_Jni.h>
#include <string>


using namespace std;

JNIEXPORT jint JNICALL Java_com_ruan_jni_Jni_add(JNIEnv *env, jobject job, jint a, jint b) {
    jint c;
    c = a + b;
    return c;
}


JNIEXPORT jstring JNICALL Java_com_ruan_jni_Jni_print(JNIEnv *env, jobject job, jstring s){
//    const char *buf = env->GetStringUTFChars(s , NULL);

    char str[] = "欢迎你的到来！";

    //字符串拼接,实现strContent+str1,因为strcat的第一个参数必须为非const类型(可变)，所以不能直接使用strcat()
    //创建一个新的字符串指针
//    char *strTemp = (char *) malloc(strlen(buf) + strlen(str) + 1);
    //拷贝常量到字符串指针
//    strcpy(strTemp,buf);
    //拼接str1到strTemp
//    strcat(strTemp,str);
    std::string hello = "Hello from C++";

    printf(str);

    return env->NewStringUTF(hello.c_str());

//    return env->NewStringUTF(str);
}

```

```shell
g++ -fPIC -shared -o A B
```

生成动态库

```shell
g++ -fPIC -shared -o test.so com.*
```

